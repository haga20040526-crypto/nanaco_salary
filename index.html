<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ¦ä¸è¨ˆç®—ï¼†å±¥æ­´ç®¡ç†</title>
    <style>
        :root {
            --mcd-red: #DA291C;
            --mcd-yellow: #FFC72C;
            --bg-color: #fffbea;
            --text-dark: #333;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background-color: var(--bg-color); color: var(--text-dark); max-width: 500px; margin: 0 auto; }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid var(--mcd-red); margin-bottom: 20px;}
        
        h1 { text-align: center; margin-bottom: 20px; font-size: 1.5rem; color: var(--mcd-red); font-weight: 900; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #555; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; -webkit-appearance: none; }
        input:focus { border-color: var(--mcd-red); outline: none; }

        button { width: 100%; padding: 14px; background-color: var(--mcd-red); color: var(--mcd-yellow); border: none; border-radius: 50px; font-size: 18px; font-weight: 900; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-top: 10px; }
        button:active { transform: scale(0.98); }

        .result-box { margin-top: 25px; background: #fffdf0; padding: 20px; border-radius: 12px; text-align: center; border: 3px solid var(--mcd-yellow); }
        .total-pay { font-size: 2.2rem; font-weight: 900; color: var(--mcd-red); margin: 10px 0; }
        .details { font-size: 0.85rem; color: #666; text-align: left; margin-top: 10px; border-top: 2px dashed var(--mcd-yellow); padding-top: 10px; }

        /* å±¥æ­´ã‚¨ãƒªã‚¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .history-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .history-title { font-weight: bold; color: var(--text-dark); }
        .clear-btn { background: #999; font-size: 0.8rem; padding: 5px 10px; width: auto; margin: 0; color: white; border-radius: 4px; }
        
        .history-list { list-style: none; padding: 0; margin: 0; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .history-date { color: #666; font-size: 0.8rem; }
        .history-money { font-weight: bold; color: var(--mcd-red); }

        .hidden { display: none; }
    </style>
</head>
<body id="mainBody" class="hidden">

<div class="container">
    <h1>i'm lovin' it ğŸ’°</h1>
    
    <div class="input-group">
        <label>åŸºæœ¬æ™‚çµ¦ (å††)</label>
        <input type="number" id="hourlyWage" placeholder="æ™‚çµ¦ã‚’å…¥åŠ›">
    </div>

    <div class="input-group">
        <label>é–‹å§‹æ™‚é–“</label>
        <input type="time" id="startTime" value="17:00">
    </div>

    <div class="input-group">
        <label>çµ‚äº†æ™‚é–“</label>
        <input type="time" id="endTime" value="23:00">
    </div>

    <div class="input-group">
        <label>ä¼‘æ†©æ™‚é–“ (åˆ†)</label>
        <input type="number" id="breakTime" value="45">
    </div>

    <button onclick="calculateAndSave()">è¨ˆç®—ã—ã¦ä¿å­˜</button>

    <div class="result-box" id="resultBox" style="display:none;">
        <div style="font-weight:bold; color:#555;">ä»Šå›ã®çµ¦ä¸</div>
        <div class="total-pay" id="displayPay">Â¥0</div>
        <div class="details" id="displayDetails"></div>
    </div>
</div>

<div class="history-section">
    <div class="history-header">
        <span class="history-title">æœ€è¿‘ã®å±¥æ­´</span>
        <button class="clear-btn" onclick="clearHistory()">å±¥æ­´ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <ul id="historyList" class="history-list">
        <li style="text-align:center; color:#999; padding:10px;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</li>
    </ul>
    <div style="text-align:right; margin-top:10px; font-weight:bold;">
        åˆè¨ˆ: <span id="grandTotal" style="color:var(--mcd-red)">Â¥0</span>
    </div>
</div>

<script>
    const APP_PASSWORD = "0107"; 
    const STORAGE_KEY_WAGE = "mcd_wage_setting";
    const STORAGE_KEY_HISTORY = "mcd_work_history";

    // åˆæœŸåŒ–å‡¦ç†
    (function init() {
        const input = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        if (input === APP_PASSWORD) {
            document.getElementById('mainBody').classList.remove('hidden');
            loadSettings(); // ä¿å­˜ã•ã‚ŒãŸæ™‚çµ¦ã‚’èª­ã¿è¾¼ã‚€
            renderHistory(); // ä¿å­˜ã•ã‚ŒãŸå±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹
        } else {
            document.body.innerHTML = "<div style='text-align:center; margin-top:50px; color:#DA291C;'><h1>ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯</h1></div>";
            document.body.style.display = "block";
        }
    })();

    // è¨­å®šï¼ˆæ™‚çµ¦ï¼‰ã‚’èª­ã¿è¾¼ã‚€
    function loadSettings() {
        const savedWage = localStorage.getItem(STORAGE_KEY_WAGE);
        if (savedWage) {
            document.getElementById('hourlyWage').value = savedWage;
        } else {
            document.getElementById('hourlyWage').value = 1100; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
        }
    }

    function calculateAndSave() {
        const wage = parseInt(document.getElementById('hourlyWage').value);
        const startStr = document.getElementById('startTime').value;
        const endStr = document.getElementById('endTime').value;
        const breakMins = parseInt(document.getElementById('breakTime').value) || 0;

        if (!wage || !startStr || !endStr) {
            alert("é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
        }

        // 1. æ™‚çµ¦ã‚’æ¬¡å›ã®ãŸã‚ã«ä¿å­˜ï¼ˆã“ã‚ŒãŒè¨­å®šä¿å­˜ã«ãªã‚Šã¾ã™ï¼‰
        localStorage.setItem(STORAGE_KEY_WAGE, wage);

        // --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå‰å›ã¨åŒã˜ï¼‰ ---
        const startDate = new Date(`2000-01-01T${startStr}`);
        let endDate = new Date(`2000-01-01T${endStr}`);
        if (endDate < startDate) endDate.setDate(endDate.getDate() + 1);

        const totalDurationMins = (endDate - startDate) / 1000 / 60;
        
        // æ·±å¤œãƒ»é€šå¸¸æ™‚é–“ã®ç®—å‡º
        let totalLateRangeMins = 0;
        let totalNormalRangeMins = 0;
        let current = new Date(startDate);

        for (let i = 0; i < totalDurationMins; i++) {
            const h = current.getHours();
            if (h >= 22 || h < 5) totalLateRangeMins++;
            else totalNormalRangeMins++;
            current.setMinutes(current.getMinutes() + 1);
        }

        // ä¼‘æ†©æ§é™¤
        let remainingBreak = breakMins;
        if (totalNormalRangeMins >= remainingBreak) {
            totalNormalRangeMins -= remainingBreak;
            remainingBreak = 0;
        } else {
            remainingBreak -= totalNormalRangeMins;
            totalNormalRangeMins = 0;
        }
        if (remainingBreak > 0) {
            totalLateRangeMins -= remainingBreak;
            if (totalLateRangeMins < 0) totalLateRangeMins = 0;
        }

        const finalWorkMins = totalNormalRangeMins + totalLateRangeMins;
        if (finalWorkMins <= 0) {
            alert("å‹¤å‹™æ™‚é–“ãŒçŸ­ã™ãã¾ã™");
            return;
        }

        const normalPay = Math.floor(wage * (totalNormalRangeMins / 60));
        const latePay = Math.floor(Math.floor(wage * 1.25) * (totalLateRangeMins / 60));
        const totalPay = normalPay + latePay;

        // --- çµæœè¡¨ç¤º ---
        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('displayPay').innerText = `Â¥${totalPay.toLocaleString()}`;
        document.getElementById('displayDetails').innerHTML = `
            é€šå¸¸: ${Math.floor(totalNormalRangeMins/60)}h${totalNormalRangeMins%60}m<br>
            æ·±å¤œ: ${Math.floor(totalLateRangeMins/60)}h${totalLateRangeMins%60}m
        `;

        // 2. å±¥æ­´ã«ä¿å­˜
        addHistory(totalPay, finalWorkMins);
    }

    // å±¥æ­´è¿½åŠ å‡¦ç†
    function addHistory(pay, mins) {
        // ç¾åœ¨ã®å±¥æ­´ã‚’å–å¾—
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY_HISTORY)) || [];
        
        const now = new Date();
        const dateStr = `${now.getMonth()+1}/${now.getDate()}`; // ä»Šæ—¥ã®æ—¥ä»˜
        const hours = Math.floor(mins / 60);
        const m = mins % 60;

        // å…ˆé ­ã«è¿½åŠ 
        history.unshift({
            date: dateStr,
            pay: pay,
            time: `${hours}h${m}m`
        });

        // ä¿å­˜
        localStorage.setItem(STORAGE_KEY_HISTORY, JSON.stringify(history));
        
        // ç”»é¢æ›´æ–°
        renderHistory();
    }

    // å±¥æ­´è¡¨ç¤ºå‡¦ç†
    function renderHistory() {
        const history = JSON.parse(localStorage.getItem(STORAGE_KEY_HISTORY)) || [];
        const listEl = document.getElementById('historyList');
        const totalEl = document.getElementById('grandTotal');
        
        listEl.innerHTML = "";
        let grandTotal = 0;

        if (history.length === 0) {
            listEl.innerHTML = "<li style='text-align:center; color:#999; padding:10px;'>å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</li>";
            totalEl.innerText = "Â¥0";
            return;
        }

        history.forEach((item, index) => {
            grandTotal += item.pay;
            const li = document.createElement('li');
            li.className = 'history-item';
            li.innerHTML = `
                <div>
                    <div class="history-date">${item.date} - ${item.time}</div>
                </div>
                <div class="history-money">Â¥${item.pay.toLocaleString()}</div>
            `;
            listEl.appendChild(li);
        });

        totalEl.innerText = `Â¥${grandTotal.toLocaleString()}`;
    }

    function clearHistory() {
        if(confirm("å±¥æ­´ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY_HISTORY);
            renderHistory();
        }
    }
</script>

</body>
</html>
